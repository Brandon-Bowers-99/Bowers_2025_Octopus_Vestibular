---
title: "Statistical Analysis"
author: "Brandon Bowers"
date: "2025-03-19"
output: html_document
---
```{r}
 library(nlme)
 library(lme4)
 library(car)
 library(tidyverse)
 library(ggplot2)
 library(lattice)
 library(nlmeU)
```

```{r}
WD = "C:\\Users\\Bvipe\\OneDrive - Walla Walla University\\Desktop\\Bowers_2025_Octopus_Vestibular"

datelist_u = c("7_24","7_26","7_28","7_30","8_1","8_3","8_5","8_7","8_9","8_11","8_13","8_15","8_17")
```

#Read in Trial-type Log
```{r}
Trial_type_log = read.csv("C:\\Users\\Bvipe\\OneDrive - Walla Walla University\\Desktop\\Bowers_2025_Octopus_Vestibular\\Raw Data\\Trial Type.csv")
```

```{r}
FV_get_file = function(WD,d){ 
  wd = c(WD,"Processed Data","Full Video Results",d)
  wd_path = stringr::str_c(wd, collapse = "/")
  in_files_list = list.files(wd_path, pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)
  return(in_files_list)
}
```

```{r}
PA_get_file = function(WD){ 
  wd = c(WD,"Processed Data\\Path Analysis Results")
  wd_path = stringr::str_c(wd, collapse = "/")
  in_files_list = list.files(wd_path, pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)
  return(in_files_list)
}
```

```{r}
FV_get_file_DLC = function(WD,d){ 
  wd = c(WD,"Processed Data","Full Video Results DLC",d)
  wd_path = stringr::str_c(wd, collapse = "/")
  in_files_list = list.files(wd_path, pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)
  return(in_files_list)
}
```

```{r}
PA_get_file_DLC = function(WD){ 
  wd = c(WD,"Processed Data\\Path Analysis Results DLC")
  wd_path = stringr::str_c(wd, collapse = "/")
  in_files_list = list.files(wd_path, pattern = NULL, all.files = FALSE,
           full.names = FALSE, recursive = FALSE,
           ignore.case = FALSE, include.dirs = FALSE, no.. = FALSE)
  return(in_files_list)
}
```


#Create a table from the the processed data that makes all effects accessible. FULL VID RESULTS
```{r}
Date = c()
OC_ID = c()
Trial_Type = c()
Duration = c()
Avg_Speed_Per_Bodylength = c()
Avg_Bearing_Change = c()
Avg_Bearing_vs_Heading_FV = c()

for (d in datelist_u){
  FV_files = FV_get_file(WD,d)
  for (f in FV_files){
    Date = c(Date,d)
    
    oc = unlist(strsplit(f,".csv"))[1]
    oc = unlist(strsplit(oc,paste0("O")))[2]
    OC_ID = c(OC_ID,oc)
    
    curr_data = read.csv(paste0(WD,"\\Processed Data\\Full Video Results\\",d,"\\",f))
    
    Time_to_crab = read.csv(paste0(WD,"\\Raw Data\\Time_to_crab.csv"))
    for (i in 1:length(Time_to_crab$Date)){
      if (Time_to_crab$Date[i] == d){
        if (as.character(Time_to_crab$OC_ID[i]) == oc){
            Duration = c(Duration,Time_to_crab$Time[i])
        }
      }
    }

    #Find average speed/bodylength and append it to master list
    avg_SPB = sum(curr_data$Speed_per_Bodylength) / length(curr_data$Speed_per_Bodylength)
    Avg_Speed_Per_Bodylength = c(Avg_Speed_Per_Bodylength,avg_SPB)
    
    #Find average bearing change
    avg_BC = sum(curr_data$Bearing_Change) / length(curr_data$Bearing_Change)
    Avg_Bearing_Change = c(Avg_Bearing_Change,avg_BC)
    
    #Find avg bearing vs heading
    avg_BvH = sum(curr_data$Bearing_Movedir_Dif) / length(curr_data$Bearing_Movedir_Dif)
    Avg_Bearing_vs_Heading_FV = c(Avg_Bearing_vs_Heading_FV,avg_BvH)
    
    for (t in 1:length(Trial_type_log$Trial.Type)){
      if (Trial_type_log$Date[t] == d & as.character(Trial_type_log$OC_ID[t]) == oc){
        Trial_Type = c(Trial_Type,Trial_type_log$Trial.Type[t])
      }
    }
  }
}

dates.ex=strptime(FV_master_set$Date,"%m_%d")
NewDates = difftime(dates.ex,min(dates.ex),units="day")

FV_master_set = data.frame(Date,OC_ID,Trial_Type, Duration, Avg_Speed_Per_Bodylength,Avg_Bearing_Change,Avg_Bearing_vs_Heading_FV)
FV_master_set = data.frame(FV_master_set,NewDates)

write.csv(FV_master_set,paste0(WD,"\\Processed Data\\FV_Master_Set.csv"))
```

#Create a table from the the processed data that makes all effects accessible. PATH ANALYSIS RESULTS
```{r}
PA_files = PA_get_file(WD)
Date = c()
OC_ID = c()
Trial_Type = c()
Movement_Type = c()
Distance_of_Movement = c()
Duration = c()
Speed = c()
Speed_per_Bodylength = c()
Bearing_Change = c()
Avg_Bearing_vs_Heading = c()
Avg_Bearing_vs_Heading_Change = c()
Avg_Directness_Difference = c()

for (fi in PA_files){
  current_data = read.csv(paste0(WD,"\\Processed Data\\Path Analysis Results\\",fi))
  Date = c(Date,current_data$date)
  OC_ID = c(OC_ID,current_data$oc_ID)
  Movement_Type = c(Movement_Type, current_data$movement_type)
  Distance_of_Movement = c(Distance_of_Movement ,current_data$total_movement_dis)
  Duration = c(Duration, current_data$duration)
  Speed = c(Speed,current_data$speed)
  Speed_per_Bodylength = c(Speed_per_Bodylength, current_data$speed_per_bodylength)
  Bearing_Change = c(Bearing_Change, current_data$angle_dev)
  Avg_Bearing_vs_Heading = c(Avg_Bearing_vs_Heading, current_data$avg_bear_head_dif)
  Avg_Bearing_vs_Heading_Change = c(Avg_Bearing_vs_Heading_Change, current_data$avg_bear_head_dif_dif)
  Avg_Directness_Difference = c(Avg_Directness_Difference, current_data$avg_head_vs_crab)
  
  count = 0
  for (t in 1:length(Trial_type_log$Trial.Type)){
    if (Trial_type_log$Date[t] == current_data$date[1]){
      for (l in 1:length(current_data$oc_ID)){
        if (current_data$oc_ID[l] == Trial_type_log$OC_ID[t]){
          Trial_Type = c(Trial_Type,Trial_type_log$Trial.Type[t])
          count = count + 1
        }
      }
    }
  }
}

dates.ex=strptime(PA_master_set$Date,"%m_%d")
NewDates = difftime(dates.ex,min(dates.ex),units="day")

PA_master_set = data.frame(Date,OC_ID,Trial_Type,Movement_Type,Distance_of_Movement,Duration,Speed,Speed_per_Bodylength,Bearing_Change,Avg_Bearing_vs_Heading,Avg_Bearing_vs_Heading_Change,Avg_Directness_Difference)
PA_master_set = data.frame(PA_master_set,NewDates)

write.csv(PA_master_set,paste0(WD,"\\Processed Data\\PA_Master_Set.csv"))
```

########
#Run mixed effects model#
########

# loading Data
```{r}
PA_master_set=read.csv("Processed Data/PA_Master_Set.csv")
FV_master_set=read.csv("Processed Data/FV_Master_Set.csv")
```


#Analyzing Path Analysis Data
##############################

#Movment type over time
lme(fixed, data, random, correlation, weights, subset, method,
    na.action, control, contrasts = NULL, keep.data = TRUE)
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(Movement_Type~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set)
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
pa_movement_subset= data.frame(PA_master_set$Trial_Type[PA_master_set$NewDates<=8], PA_master_set$Movement_Type[PA_master_set$NewDates<=8],PA_master_set$NewDates[PA_master_set$NewDates<=8])

chisq.test(pa_movement_subset$PA_master_set.Movement_Type.PA_master_set.NewDates....8.,pa_movement_subset$PA_master_set.Trial_Type.PA_master_set.NewDates....8.)
```
#Bearing change for Bearing change, Movement Type == 1 not run because the calculation is not applicable
#Bearing change, Movement Type == 2
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Bearing_Change)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA

prediction = predict(bearing_change.lme, PA_master_set[PA_master_set$Movement_Type==2,])

```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Bearing_Change)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==2])),
     pch=21,bg="red",
     main = "Absolute Values of Average Bearing Change in Jetting Movements",
     xlab = "Number of days since start of experiment",
     ylab = "Bearing Change (Radians)"
     )
points(abs(Bearing_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])~NewDates[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1],
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_BC_SPUN = abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_BC_CONTROL = abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_BC_SPUN_norm <- rnorm(4,mean=mean(PA_BC_SPUN, na.rm=TRUE), sd=sd(PA_BC_SPUN, na.rm=TRUE))
PA_BC_CONTROL_norm <- rnorm(84,mean=mean(PA_BC_CONTROL, na.rm=TRUE), sd=sd(PA_BC_CONTROL, na.rm=TRUE))

boxplot(PA_BC_CONTROL,PA_BC_SPUN,
main = "Average Bearing Change in Jetting Movements",
ylab = "Average Bearing Change (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```



#Avg Directness Difference (movement type 1)
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Directness_Difference)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==1,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA

```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Directness_Difference)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Avg_Directness_Difference[PA_master_set$Movement_Type==1])),
     pch=21,bg="red"
     )
points(abs(Avg_Directness_Difference)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_DD_SPUN = abs(PA_master_set$Avg_Directness_Difference[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])
PA_DD_CONTROL = abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])

PA_DD_SPUN_norm <- rnorm(0.25,mean=mean(PA_DD_SPUN, na.rm=TRUE), sd=sd(PA_DD_SPUN, na.rm=TRUE))
PA_DD_CONTROL_norm <- rnorm(0.25,mean=mean(PA_DD_CONTROL, na.rm=TRUE), sd=sd(PA_DD_CONTROL, na.rm=TRUE))

boxplot(PA_DD_CONTROL,PA_DD_SPUN,
main = "Average Directness Difference in Crawling Movements",
ylab = "Average Directness Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```

#Avg Directness Difference (movement type 2)
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Directness_Difference)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Directness_Difference)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Avg_Directness_Difference[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(abs(Avg_Directness_Difference)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_DD_SPUN = abs(PA_master_set$Avg_Directness_Difference[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_DD_CONTROL = abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_DD_SPUN_norm <- rnorm(0.25,mean=mean(PA_DD_SPUN, na.rm=TRUE), sd=sd(PA_DD_SPUN, na.rm=TRUE))
PA_DD_CONTROL_norm <- rnorm(0.25,mean=mean(PA_DD_CONTROL, na.rm=TRUE), sd=sd(PA_DD_CONTROL, na.rm=TRUE))

boxplot(PA_DD_CONTROL,PA_DD_SPUN,
main = "Average Directness Difference in Jetting Movements",
ylab = "Average Directness Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Avg speed per body length, movement type 1
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Speed_per_Bodylength)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==1,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```

## trying out a new 




```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Speed_per_Bodylength)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])),
     xlim=range(0,24),
     pch=21,bg="red"
     )
points(abs(Speed_per_Bodylength[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])~NewDates[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1],
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy,col="red")
lines(s_dates_pred,spun_predy,col="blue")

print(predicted_data)
```
```{r}
PA_SPB_SPUN = abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])
PA_SPB_CONTROL = abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])

PA_SPB_SPUN_norm <- rnorm(0.25,mean=mean(PA_SPB_SPUN, na.rm=TRUE), sd=sd(PA_SPB_SPUN, na.rm=TRUE))
PA_SPB_CONTROL_norm <- rnorm(0.25,mean=mean(PA_SPB_CONTROL, na.rm=TRUE), sd=sd(PA_SPB_CONTROL, na.rm=TRUE))

boxplot(PA_SPB_CONTROL,PA_SPB_SPUN,
main = "Average Speed per Bodylength in Crawling Movements",
ylab = "Average Speed per Bodylength (Body Lengths per 0.166 seconds)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Avg speed per body length, movement type 2
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Speed_per_Bodylength)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Speed_per_Bodylength[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])~NewDates[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4],
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(abs(Speed_per_Bodylength[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])~NewDates[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1],
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_SPB_SPUN = abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_SPB_CONTROL = abs(PA_master_set$Speed_per_Bodylength[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_SPB_SPUN_norm <- rnorm(4,mean=mean(PA_SPB_SPUN, na.rm=TRUE), sd=sd(PA_SPB_SPUN, na.rm=TRUE))
PA_SPB_CONTROL_norm <- rnorm(84,mean=mean(PA_SPB_CONTROL, na.rm=TRUE), sd=sd(PA_SPB_CONTROL, na.rm=TRUE))

boxplot(PA_SPB_CONTROL,PA_SPB_SPUN,
main = "Average Speed per Bodylength in Jetting Movements",
ylab = "Average Speed per Bodylength (pixels)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```

#Avg Bearing vs Heading, movement type == 1
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Bearing_vs_Heading)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==1,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Bearing_vs_Heading)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Bearing_Change[PA_master_set$Movement_Type==1])),
     pch=21,bg="red"
     )
points(abs(Avg_Bearing_vs_Heading)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_BvH_SPUN = abs(PA_master_set$Avg_Bearing_vs_Heading[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])
PA_BvH_CONTROL = abs(PA_master_set$Avg_Bearing_vs_Heading[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])

PA_BvH_SPUN_norm <- rnorm(0.25,mean=mean(PA_BvH_SPUN, na.rm=TRUE), sd=sd(PA_BvH_SPUN, na.rm=TRUE))
PA_BvH_CONTROL_norm <- rnorm(0.25,mean=mean(PA_BvH_CONTROL, na.rm=TRUE), sd=sd(PA_BvH_CONTROL, na.rm=TRUE))

boxplot(PA_BvH_CONTROL,PA_BvH_SPUN,
main = "Average Bearing-Heading Difference in Crawling Movements",
ylab = "Average Bearing-Heading Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Avg Bearing vs Heading, movement type == 2
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Bearing_vs_Heading)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Bearing_vs_Heading)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     main= "Bearing-heading difference in jetting movements" ,
     #log="y",
     ylim=range(abs(PA_master_set$Avg_Bearing_vs_Heading[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(abs(Avg_Bearing_vs_Heading)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_BvH_SPUN = abs(PA_master_set$Avg_Bearing_vs_Heading[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_BvH_CONTROL = abs(PA_master_set$Avg_Bearing_vs_Heading[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_BvH_SPUN_norm <- rnorm(4,mean=mean(PA_BvH_SPUN, na.rm=TRUE), sd=sd(PA_BvH_SPUN, na.rm=TRUE))
PA_BvH_CONTROL_norm <- rnorm(84,mean=mean(PA_BvH_CONTROL, na.rm=TRUE), sd=sd(PA_BvH_CONTROL, na.rm=TRUE))

boxplot(PA_BvH_CONTROL,PA_BvH_SPUN,
main = "Average Bearing-Heading Difference in Jetting Movements",
ylab = "Average Bearing-Heading Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```

#Average Heading vs Bearing Change, Movement Type == 1
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Bearing_vs_Heading_Change)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==1,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Bearing_vs_Heading_Change)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(abs(Avg_Bearing_vs_Heading_Change)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_BvHC_SPUN = abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])
PA_BvHC_CONTROL = abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])

PA_BvHC_SPUN_norm <- rnorm(0.25,mean=mean(PA_BvHC_SPUN, na.rm=TRUE), sd=sd(PA_BvHC_SPUN, na.rm=TRUE))
PA_BvHC_CONTROL_norm <- rnorm(0.25,mean=mean(PA_BvHC_CONTROL, na.rm=TRUE), sd=sd(PA_BvHC_CONTROL, na.rm=TRUE))

boxplot(PA_BvHC_CONTROL,PA_BvHC_SPUN,
main = "Avg. Change in Bearing-Heading Difference - Crawling",
ylab = "Average Bearing-Heading Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Average Heading vs Bearing Change, Movement Type == 2
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Avg_Bearing_vs_Heading_Change)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(abs(Avg_Bearing_vs_Heading_Change)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(abs(Avg_Bearing_vs_Heading_Change)~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_BvHC_SPUN = abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_BvHC_CONTROL = abs(PA_master_set$Avg_Bearing_vs_Heading_Change[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_BvHC_SPUN_norm <- rnorm(0.25,mean=mean(PA_BvHC_SPUN, na.rm=TRUE), sd=sd(PA_BvHC_SPUN, na.rm=TRUE))
PA_BvHC_CONTROL_norm <- rnorm(0.25,mean=mean(PA_BvHC_CONTROL, na.rm=TRUE), sd=sd(PA_BvHC_CONTROL, na.rm=TRUE))

boxplot(PA_BvHC_CONTROL,PA_BvHC_SPUN,
main = "Avg. Change in Bearing-Heading Difference - Jetting",
ylab = "Average Bearing-Heading Difference (radians)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Duration, Movement Type ==  1
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Duration)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==1,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(Duration~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(PA_master_set$Duration[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(Duration~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_Duration_SPUN = abs(PA_master_set$Duration[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==1])
PA_Duration_CONTROL = abs(PA_master_set$Duration[PA_master_set$Movement_Type==1&PA_master_set$Trial_Type==4])

PA_Duration_SPUN_norm <- rnorm(0.25,mean=mean(PA_Duration_SPUN, na.rm=TRUE), sd=sd(PA_Duration_SPUN, na.rm=TRUE))
PA_Duration_CONTROL_norm <- rnorm(0.25,mean=mean(PA_Duration_CONTROL, na.rm=TRUE), sd=sd(PA_Duration_CONTROL, na.rm=TRUE))

boxplot(PA_Duration_CONTROL,PA_Duration_SPUN,
main = "Duration of Crawling Movements",
ylab = "Duration (Seconds)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#Duration, Movement Type ==  2
```{r}
PA_master_set$Trial_Type=as.factor(PA_master_set$Trial_Type)

bearing_change.lme=lme(abs(Duration)~Trial_Type*NewDates,random=~1|OC_ID,
                       data=PA_master_set[PA_master_set$Movement_Type==2,])
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(PA_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(PA_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(Duration~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4,],
     #log="y",
     main = "Duration of Directed movements",
     ylim=range(abs(PA_master_set$Duration[PA_master_set$Movement_Type==2])),
     pch=21,bg="red"
     )
points(Duration~NewDates,
     data=PA_master_set[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1,],
     pch=21,bg="blue")
legend("topright",c("Spun","Unspun"),fill = c("blue","red"))

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)

print(predicted_data)
```
```{r}
PA_Duration_SPUN = abs(PA_master_set$Duration[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==1])
PA_Duration_CONTROL = abs(PA_master_set$Duration[PA_master_set$Movement_Type==2&PA_master_set$Trial_Type==4])

PA_Duration_SPUN_norm <- rnorm(0.25,mean=mean(PA_Duration_SPUN, na.rm=TRUE), sd=sd(PA_Duration_SPUN, na.rm=TRUE))
PA_Duration_CONTROL_norm <- rnorm(0.25,mean=mean(PA_Duration_CONTROL, na.rm=TRUE), sd=sd(PA_Duration_CONTROL, na.rm=TRUE))

boxplot(PA_Duration_CONTROL,PA_Duration_SPUN,
main = "Duration of Jetting Movements",
ylab = "Duration (Seconds)",
at = c(1,2),
names = c("Control", "Spun"),
las = 2,
col = c("#C1FFC1","#FFAEB9"),
border = "black",
horizontal = FALSE,
notch = FALSE
)
```


#################
#FULL VIDEO ANALYSIS
#################
#Duration
```{r}
FV_master_set$Trial_Type=as.factor(FV_master_set$Trial_Type)

bearing_change.lme=lme(Duration~Trial_Type,random=~1|OC_ID, 
                       correlation=corAR1(form= ~NewDates|OC_ID),
                       data=FV_master_set)

bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
#summary(bearing_change.lme)
#AIC(bearing_change.lme) 
```
```{r}
unique(FV_master_set$Trial_Type)
date_l = c(0,0,8,24)
predict.data=data.frame(Trial_Type=as.factor(rep(unique(FV_master_set$Trial_Type),32)),NewDates=rep(date_l,16),OC_ID=c(1,1,1,1,2,2,2,2,4,4,4,4,5,5,5,5,7,7,7,7,8,8,8,8,9,9,9,9,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(Duration~NewDates,
     data=FV_master_set[FV_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(FV_master_set$Duration)),
     pch=21,bg="red"
     )
points(Duration~NewDates,
     data=FV_master_set[FV_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)
plot(bearing_change.lme, which = 1)
```

#Avg Speed per Body Length
```{r}
FV_master_set$Trial_Type=as.factor(FV_master_set$Trial_Type)

bearing_change.lme=lme(Avg_Speed_Per_Bodylength~Trial_Type,random=~1|OC_ID, 
                       correlation=corAR1(form= ~NewDates|OC_ID),
                       data=FV_master_set)
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```
```{r}
unique(FV_master_set$Trial_Type)

predict.data=data.frame(Trial_Type=as.factor(rep(unique(FV_master_set$Trial_Type),2)),NewDates=c(0,0,8,24))

predict.data$predict=predict(bearing_change.lme,newdata = predict.data,level=0)
predicted_data = predict.data

unspun_predy = c(predicted_data$predict[2],predicted_data$predict[4])
spun_predy = c(predicted_data$predict[1],predicted_data$predict[3])
u_dates_pred = c(0,24)
s_dates_pred = c(0,8)

plot(Avg_Speed_Per_Bodylength~NewDates,
     data=FV_master_set[FV_master_set$Trial_Type==4,],
     #log="y",
     ylim=range(abs(FV_master_set$Avg_Speed_Per_Bodylength)),
     pch=21,bg="red"
     )
points(Avg_Speed_Per_Bodylength~NewDates,
     data=FV_master_set[FV_master_set$Trial_Type==1,],
     pch=21,bg="blue")

lines(u_dates_pred,unspun_predy)
lines(s_dates_pred,spun_predy)
plot(bearing_change.lme, which = 1)
```

#Avg Bearing Change
```{r}
FV_master_set$Trial_Type=as.factor(FV_master_set$Trial_Type)

bearing_change.lme=lme(Avg_Bearing_Change~Trial_Type,random=~1|OC_ID, 
                       correlation=corAR1(form= ~NewDates|OC_ID),
                       data=FV_master_set)
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```

#Avg Bearing vs heading
```{r}
FV_master_set$Trial_Type=as.factor(FV_master_set$Trial_Type)

dates.ex=strptime(FV_master_set$Date,"%m_%d")
NewDates = difftime(dates.ex,min(dates.ex),units="day")

bearing_change.lme=lme(Avg_Bearing_vs_Heading_FV~Trial_Type,random=~1|OC_ID, 
                       correlation=corAR1(form= ~NewDates|OC_ID),
                       data=FV_master_set)
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```

##Power Analysis
```{r}
library(compute.es)
library(pwr)
```

```{r}
c_n = 0
t_n = 0

for (i in 1:length(FV_master_set$Trial_Type)){
  if (FV_master_set$Trial_Type[i] == 4){
    c_n = c_n + 1
  }
  else if (FV_master_set$Trial_Type[i] == 1){
    t_n = t_n + 1
  }
}
```

```{r}
 control.mean= mean(FV_master_set$Duration[FV_master_set$Trial_Type==4])
 control.sd= sd(FV_master_set$Duration[FV_master_set$Trial_Type==4])
 control.n = c_n
 treat.mean= mean(FV_master_set$Duration[FV_master_set$Trial_Type==1])
 treat.sd= sd(FV_master_set$Duration[FV_master_set$Trial_Type==1])
 treat.n= t_n  
```

```{r}
 eff=mes(treat.mean,control.mean,treat.sd,control.sd,treat.n,control.n)
```

```{r}
pwr.t.test(n= 172, d= -0.33, sig.level=0.05,power=NULL,type="paired",alternative="less")
```


###
#Finding means
###
#Full video: Avg Speed per Body Length means: Spun and Unspun
```{r}
#FV avgspeedpbl

U_AVGS = c()
S_AVGS = c()

for (ro in 1:length(FV_master_set$Avg_Speed_Per_Bodylength)){
  if (FV_master_set$Trial_Type[ro] == "1"){
    S_AVGS = c(S_AVGS, FV_master_set$Avg_Speed_Per_Bodylength[ro])
  }
  else if (FV_master_set$Trial_Type[ro] == "4"){
    U_AVGS = c(U_AVGS, FV_master_set$Avg_Speed_Per_Bodylength[ro])
  }
}

U_mean = mean(U_AVGS)
S_mean = mean(S_AVGS)

print(paste0("Unspun Average Speed per Bodylength: ",U_mean," Spun Average Speed per Bodylength: ",S_mean))
```

#Path analysis: Avg Bearing vs Heading Movement type 2 (Jetting): Over time
```{r}

```

# Testing out some power analysis types

## Avg Bearing Change
```{r}
FV_master_set$Trial_Type=as.factor(FV_master_set$Trial_Type)

bearing_change.lme=lme(Avg_Bearing_Change~Trial_Type,random=~1|OC_ID, 
                       correlation=corAR1(form= ~NewDates|OC_ID),
                       data=FV_master_set)
bearing_change.ANOVA=Anova(bearing_change.lme,type="III")
bearing_change.ANOVA
```

```{r}
Pwr(
  obj = bearing_change.lme,
  Terms = "Trial_Type",
  alpha = 0.05,
  method = "z"
)

```

```{r}

obs_diff =  mean(FV_master_set$Avg_Bearing_Change[FV_master_set$Trial_Type == "4"]) -
            mean(FV_master_set$Avg_Bearing_Change[FV_master_set$Trial_Type == "1"])

step=obs_diff/10

temporary=FV_master_set
output=data.frame(mean_diff=numeric(),power=numeric())
i=1
temp.pwr=0

while (temp.pwr<0.8){
  
temporary$Avg_Bearing_Change[FV_master_set$Trial_Type == "4"]=
  temporary$Avg_Bearing_Change[FV_master_set$Trial_Type == "4"]+step

mean_diff=mean(temporary$Avg_Bearing_Change[temporary$Trial_Type == "4"]) -
            mean(temporary$Avg_Bearing_Change[temporary$Trial_Type == "1"])

temp.lme=lme(
             Avg_Bearing_Change~Trial_Type,
             random=~1|OC_ID, 
             correlation=corAR1(form= ~NewDates|OC_ID),
             data=temporary
             )

temp.pwr=Pwr(
  obj = temp.lme,
  Terms = "Trial_Type",
  alpha = 0.05,
  method = "z"
)$Power

power=temp.pwr
output=rbind(output, data.frame(mean_diff = mean_diff, power = temp.pwr))

i=i+1
}


output
```

```{r}
plot(power~mean_diff,data=output,type="l")
```





